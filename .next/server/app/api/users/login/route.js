"use strict";(()=>{var e={};e.id=373,e.ids=[373],e.modules={1185:e=>{e.exports=require("mongoose")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},7147:e=>{e.exports=require("fs")},2037:e=>{e.exports=require("os")},1017:e=>{e.exports=require("path")},2781:e=>{e.exports=require("stream")},3837:e=>{e.exports=require("util")},2105:(e,o,r)=>{r.r(o),r.d(o,{originalPathname:()=>w,patchFetch:()=>h,requestAsyncStorage:()=>v,routeModule:()=>f,serverHooks:()=>E,staticGenerationAsyncStorage:()=>x});var s={};r.r(s),r.d(s,{POST:()=>m});var n=r(9303),t=r(8716),i=r(670),a=r(5349),l=r(839),u=r(7070),c=r(2023),p=r.n(c),d=r(1482),g=r.n(d);async function m(e){try{console.log("Entering POST function");let{email:o,password:r}=await e.json();console.log("Received email:",o),console.log("Received password:",r),console.log("Searching for user in database");let s=await l.Z.findOne({email:o});if(!s)return console.log("User not found"),u.NextResponse.json({message:"Invalid username or password"},{status:401});if(console.log("User found:",s.email),console.log("Comparing passwords"),!await p().compare(r,s.password))return console.log("Invalid password"),u.NextResponse.json({message:"Invalid username or password"},{status:401});console.log("Password is valid");let n={id:s._id,username:s.username,email:s.email};if(console.log("Token data prepared:",n),console.log("Checking TOKEN_SECRET:",process.env.TOKEN_SECRET?"exists":"does not exist"),!process.env.TOKEN_SECRET)return console.error("TOKEN_SECRET is not set in the environment"),u.NextResponse.json({message:"Server configuration error"},{status:500});let t=await g().sign(n,process.env.TOKEN_SECRET,{expiresIn:"1h"});console.log("Token generated");let i=u.NextResponse.json({message:"Login Successful",success:!0});return i.cookies.set("token",t,{httpOnly:!0}),console.log("Cookie set"),console.log("Returning successful response"),i}catch(e){return console.error("Error during login:",e),console.error("Error stack:",e.stack),u.NextResponse.json({message:"Internal Server Error"},{status:500})}}r(6636).config(),(0,a.$)();let f=new n.AppRouteRouteModule({definition:{kind:t.x.APP_ROUTE,page:"/api/users/login/route",pathname:"/api/users/login",filename:"route",bundlePath:"app/api/users/login/route"},resolvedPagePath:"C:\\Users\\Abhisek Samal\\Desktop\\Ecoomerce_next\\src\\app\\api\\users\\login\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:v,staticGenerationAsyncStorage:x,serverHooks:E}=f,w="/api/users/login/route";function h(){return(0,i.patchFetch)({serverHooks:E,staticGenerationAsyncStorage:x})}},5349:(e,o,r)=>{r.d(o,{$:()=>t});var s=r(1185),n=r.n(s);async function t(){try{let e=process.env.MONGO_URI;if(console.log("MongoDB URI:",e),!e)throw Error("MONGO_URI is not defined in the environment variables");await n().connect(e);let o=n().connection;o.on("connected",()=>{console.log("MongoDB connected successfully")}),o.on("error",e=>{console.log(`MongoDB connection error. Please make sure MongoDB is running. ${e}`),process.exit(1)})}catch(e){console.log("Something went wrong"),console.log(e),process.exit(1)}}r(6636).config()},839:(e,o,r)=>{r.d(o,{Z:()=>i});var s=r(1185),n=r.n(s);let t=new(n()).Schema({username:{type:String,required:[!0,"Please provide a username"],unique:!0},email:{type:String,required:[!0,"Please provide an email"],unique:!0},password:{type:String,required:[!0,"Please provide a password"]},isVerified:{type:Boolean,default:!1},isAdmin:{type:Boolean,default:!1},forgotPasswordToken:String,forgotPasswordTokenExpiry:Date,verifyToken:String,verifyTokenExpiry:Date}),i=n().models.users||n().model("users",t)}};var o=require("../../../../webpack-runtime.js");o.C(e);var r=e=>o(o.s=e),s=o.X(0,[948,972,695,23],()=>r(2105));module.exports=s})();